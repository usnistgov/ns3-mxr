# 5G mmWave Mixed Reality (MXR) Simulation
This repository contains the code needed to reproduce the results presented in the [LINKTOCREATE](https://nothinghere): paper.
In this paper, we simulate a 5G Medical Extended Reality (MXR) setup where a surgeon carries  a headset to perform a surgery on a patient and benefits of the advantages of MXR (ADD examples here). The communication is performed in the Millimeter (mmWave)  band from a Remote Host (RH) to the User Equiment (UE). The traffic employed is detailed in LINK and represents Reduced Function Headset (RFH),
also known as remote rendering.

This ns-3 implementation uses two repositories:
* [NYU WIRELESS UniPD ns-3 mmWave Module](https://github.com/nyuwireless-unipd/ns3-mmwave): This is the core version of ns-3 used
* [UniPD ns-3 QD channel model](https://apps.nsnam.org/app/qd-channel/): This module allows the the ns-3 integration of the Quasi-Deterministic (Q-D) channel model to obtain high-fidelity mmWave channel model. 

We provide additionally the code needed to represents the RFH traffic and in particular a CDF traffic-based generator that helps to accurately represents the RFH traffic.

# The MRX scenario
The MXR scenario is implementend in the "mxr.cc" file located in the "scratch" folder.
In this scenario, three nodes are present:
* A remote host that will send the MXR traffic
* A 5G BS that will remain static for the entire simulation. We provide 10 scenarios where each scenario varies by the position of the BS. 
* A 5G UE that will represents the surgeon's head. By default, the surgeon's head focuses on the patient for 100 s, then moves his/her head for 10s to either engage conversation with staffs or check imagery and this for a duratio of  20 seconds, and then comes back to focus on the patient (10s). The surgeon's head moves randomly by +-10cm along the x and y axis. The surgeon's mobility and rotation is the same for all the 10 sceanrios provides.

We have reconstructed a 3D model of an authentic operation room of dimensions 5.75 m by 5.48 m by 2.8 m. The picture below describes the 10 different positions of the BS corresponding to the 10 scenarios.



The video below shows the mobility of the UE. 

![A visualization of an MXR Scenario](scenario.gif)


# How to generate the scenarios
The mobility model is generated using [MXR scenario generator](https://nothinghere). 
Once the scenario are generated, the channel for theses scenarios must be generated using the [NIST Q-D channel realizations software](https://github.com/wigig-tools/qd-realization).
To do so, place the "surgeryScenarios" folder generated by the MXR scenario generator inside the "src/examples" folder. Then, you need to update the line [here](https://github.com/wigig-tools/qd-realization/blob/1ccf0cb61c1741cc3471db8ec0373c5383da58be/src/main.m#L56C48-L57C1), i.e., inside "src/main.m" file, to reflect the scenario for which you want to generate the channel. Finally. run the "src/main/m" script.
The channel is now generated and must be imported inside ns-3. 
To do so, copy-paste the scenarios you've just generated inside the "contrib/psc/qd-channel/model/QD/" folder of this repo. Please note that the 10 scenarios used for the paper are already included in this repo ("MXRPosition1" to "MXR Position 10" folder).

# RFH App
This repo comes with 11 RFH Apps. 7 of them (from 1 to 7) represents the RFH app presented in [LINKTOCREATE](https://nothinghere). This paper came up with CDF distribution to represent the traffic observed during measurements campaigns for various use-cases. The remaining 4 RFH apps representing higher datarate traffic such as the one used in our paper to represent 4K and 8K traffic and two additional ones for 22 Mbps and 220 Mbps datarate.

# Usage
To launch the simulation, use 
```bash
./ns3 run "mxr"
```
This will use the default parameters.

# Parameters
* "scenario": The name of the folder that will be used and in particular the folder containing the Q-D files generated using the NIST Q-D channel software. Valid entries are [MXRPosition1,MXRPosition2,MXRPosition3,MXRPosition4,MXRPosition5,MXRPosition6,MXRPosition7,MXRPosition8,MXRPosition9,MXRPosition10] Default: MXRPosition1
* "txPower": The transmit power (in dBm) used by the BS and UE to perform transmission. Default: 10 dBm
* "noiseFigure": The noise figure (in dBm) for both the BS and UE. Default: 12 dBm
* "appStart": The application start time (in s). Default: 1 s
* "appEnd": The application end time (in s). Default: 300 s
* "resultsFolder": Where to save the output traces. Default: ResultsMXR
* "rfhTraffic": Is RFH traffic enabled. Default: true
* "rfhAppId"" The ID of the RFH App. Valid entries are [1,2,3,4,5,6,7,22Mbps,220Mbps,4K,8K]. Default: 1
* "beamformingInterval": How often is performed the beamforming training between the BS and UE (default 1 s)
* "codebookFile": The finename of the codebook to use (default: 1x16.txt)


# Output
The output results will be generated into the "resultsFolder/beamFIntervalX" where results folder corresponds to the "resultsFolder" parameter and X corresponds to the "beamformingInterval" parameter value.
There are four output generated. The file name of the four output all adopt the same nomenclature:
MXRPosition1_Beamforming_rfh-app-1_txPower20.0_runNumber1.txt
scenario_results_rclValue



